<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat to Images</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background-color: #e5ddd5;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
    }
    .chat-window {
      background-color: #fff;
      width: 100%;
      max-width: 600px;
      margin: 16px 0;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      /* 内容撑开时自动扩高，不滚动 */
      height: auto !important;
    }
    .chat-header {
      background-color: #0084ff;
      color: #fff;
      padding: 16px;
      font-weight: bold;
      font-size: 18px;
    }
    .chat-body {
      padding: 20px;
      display: flex;
      flex-direction: column;
      /* 关键覆盖： */
      max-height: none !important;
      height: auto !important;
      overflow: visible !important;
      flex: none !important;
    }
    .chat-message { display: flex; align-items: flex-end; margin-bottom: 10px; }
    .user { justify-content: flex-end; }
    .bot  { justify-content: flex-start; }
    .message {
      background: #f1f0f0;
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 80%;
      line-height: 1.4;
      word-break: break-word;
    }
    .user .message { background: #0084ff; color: #fff; border-top-right-radius: 0; }
    .bot  .message { border-top-left-radius: 0; }
    .avatar {
      width: 24px; height: 24px;
      background-color: #0084ff;
      border-radius: 50%;
      margin-right: 8px;
    }
    .doc-row { display: flex; margin-bottom: 15px; }
    .doc-row.bot { justify-content: flex-start; }
    .chatgpt-doc {
      display: flex; align-items: center;
      background: #f1f0f0;
      border-radius: 12px;
      padding: 10px 16px;
      gap: 8px;
    }
    .chatgpt-doc-icon { width: 24px; height: 24px; }
    .chatgpt-doc-text strong { font-weight: bold; font-size: 14px; }
    #images { margin-top: 32px; display: flex; flex-direction: column; gap: 16px; }
    #images img { border: 1px solid #ccc; }
  </style>
</head>
<body>
  <!-- 窗口 1 -->
  <div class="chat-window" id="chat-window-1">
    <div class="chat-header">AI assistant (part 1)</div>
    <div class="chat-body" id="chat-body-1"></div>
  </div>
  <!-- 窗口 2 -->
  <div class="chat-window" id="chat-window-2">
    <div class="chat-header">AI assistant (part 2)</div>
    <div class="chat-body" id="chat-body-2"></div>
  </div>
  <!-- 生成图片显示区 -->
  <div id="images"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const msgs = [... /* 你的所有消息数组 */];

      const mid = Math.ceil(msgs.length/2);
      const parts = [ msgs.slice(0, mid), msgs.slice(mid) ];

      function render(msgs, container) {
        msgs.forEach(m => {
          const row = document.createElement('div');
          row.className = 'chat-message ' + m.role;
          if (m.role==='bot') {
            const av = document.createElement('div'); av.className='avatar';
            row.appendChild(av);
          }
          const txt = document.createElement('div');
          txt.className = 'message';
          txt.textContent = m.text;
          row.appendChild(txt);
          container.appendChild(row);

          if (m.doc) {
            const dr = document.createElement('div');
            dr.className = 'doc-row bot';
            const d = document.createElement('div'); d.className='chatgpt-doc';
            const ic = document.createElement('img');
            ic.src = 'https://img.icons8.com/ios-filled/50/ffffff/document--v1.png';
            ic.className='chatgpt-doc-icon';
            const td = document.createElement('div');
            td.className='chatgpt-doc-text';
            td.innerHTML = '<strong>paper.doc</strong>';
            d.append(ic, td);
            dr.appendChild(d);
            container.appendChild(dr);
          }
        });
      }

      render(parts[0], document.getElementById('chat-body-1'));
      render(parts[1], document.getElementById('chat-body-2'));

      // 延迟让浏览器完成布局，再截图
      setTimeout(() => {
        ['chat-window-1','chat-window-2'].forEach(id => {
          html2canvas(document.getElementById(id)).then(canvas => {
            const img = new Image();
            img.src = canvas.toDataURL('image/png');
            document.getElementById('images').appendChild(img);
          });
        });
      }, 300);
    });
  </script>
</body>
</html>
