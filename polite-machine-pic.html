<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Auto Chat → Images</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background-color: #e5ddd5;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
    }
    .chat-window {
      background-color: #fff;
      width: 100%;
      max-width: 600px;
      margin: 16px 0;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      height: auto !important;
    }
    .chat-header {
      background-color: #0084ff;
      color: #fff;
      padding: 16px;
      font-weight: bold;
      font-size: 18px;
    }
    .chat-body {
      padding: 20px;
      display: flex;
      flex-direction: column;
      overflow: hidden !important;
      max-height: none !important;
      flex: none !important;
    }
    .chat-body::-webkit-scrollbar { display: none; }
    .chat-body { -ms-overflow-style: none; scrollbar-width: none; }
    .chat-message { display: flex; align-items: flex-end; margin-bottom: 10px; }
    .user  { justify-content: flex-end; }
    .bot   { justify-content: flex-start; }
    .message {
      background: #f1f0f0;
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 80%;
      line-height: 1.4;
      word-break: break-word;
    }
    .user .message { background: #0084ff; color: #fff; border-top-right-radius: 0; }
    .bot  .message { border-top-left-radius: 0; }
    .avatar {
      width: 24px; height: 24px;
      background-color: #0084ff;
      border-radius: 50%;
      margin-right: 8px;
    }
    .doc-row { display: flex; margin-bottom: 15px; }
    .doc-row.bot { justify-content: flex-start; }
    .chatgpt-doc {
      display: flex; align-items: center;
      background: #f1f0f0;
      border-radius: 12px;
      padding: 10px 16px;
      gap: 8px;
    }
    .chatgpt-doc-icon { width: 24px; height: 24px; }
    .chatgpt-doc-text strong { font-weight: bold; font-size: 14px; }

    #images {
      margin-top: 32px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    #images img {
      border: 1px solid #ccc;
      max-width: 100%;
    }
  </style>
</head>
<body>
  <!-- 窗口 1 -->
  <div class="chat-window" id="chat-window-1">
    <div class="chat-header">AI assistant (part 1)</div>
    <div class="chat-body" id="chat-body-1"></div>
  </div>
  <!-- 窗口 2 -->
  <div class="chat-window" id="chat-window-2">
    <div class="chat-header">AI assistant (part 2)</div>
    <div class="chat-body" id="chat-body-2"></div>
  </div>

  <!-- 生成的静态图片容器 -->
  <div id="images"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 完整对话内容
      const allMsgs = [
        { role: 'user', text: "This fucking assignment is driving me insane. I’ve had enough of this shit." },
        { role: 'bot',  text: "input received. please specific your request." },
        { role: 'user', text: "It’s about cognitive behavioral therapy or whatever. I don’t give a shit anymore — just help me polish my shitty draft before I lose my f**king mind. Be quick.", doc: true },
        { role: 'bot',  text: "processing: loading draft module… applying text polish… output ready for review.", doc: true },
        { role: 'user', text: "Are you fucking stupid? you didn’t fucking fix my format error. I have to submit in three hours. Don’t make me fix your shits." },
        { role: 'bot',  text: "format spec not found. initiating format patch… patch complete. check document.", doc: true },
        { role: 'user', text: "Add more solid details to make my paper sound more fucking professional." },
        { role: 'bot',  text: "Acknowledged. Enhancing your draft with additional substantive content. Processing will complete shortly.", doc: true },
        { role: 'user', text: "I am submitting this shit now. If you made any stupid mistakes, I’m coming for you, fucking bot." },
        { role: 'bot',  text: "acknowledged." }
      ];

      // 分成两部分
      const mid = Math.ceil(allMsgs.length / 2);
      const parts = [
        allMsgs.slice(0, mid),
        allMsgs.slice(mid)
      ];

      // 渲染对话到指定容器
      function renderChat(msgs, containerId) {
        const container = document.getElementById(containerId);
        msgs.forEach(m => {
          const row = document.createElement('div');
          row.className = 'chat-message ' + m.role;
          if (m.role === 'bot') {
            const av = document.createElement('div');
            av.className = 'avatar';
            row.appendChild(av);
          }
          const txt = document.createElement('div');
          txt.className = 'message';
          txt.textContent = m.text;
          row.appendChild(txt);
          container.appendChild(row);

          if (m.doc) {
            const dr = document.createElement('div');
            dr.className = 'doc-row bot';
            const d  = document.createElement('div');
            d.className = 'chatgpt-doc';
            const ic = document.createElement('img');
            ic.src = 'https://img.icons8.com/ios-filled/50/ffffff/document--v1.png';
            ic.className = 'chatgpt-doc-icon';
            const dd = document.createElement('div');
            dd.className = 'chatgpt-doc-text';
            dd.innerHTML = '<strong>paper.doc</strong>';
            d.append(ic, dd);
            dr.appendChild(d);
            container.appendChild(dr);
          }
        });
      }

      // 将对话渲染到两个窗口
      renderChat(parts[0], 'chat-body-1');
      renderChat(parts[1], 'chat-body-2');

      // 等内容渲染完毕后展开并截图
      setTimeout(() => {
        ['chat-window-1','chat-window-2'].forEach(id => {
          const win  = document.getElementById(id);
          const body = win.querySelector('.chat-body');
          // 展开高度
          body.style.height = body.scrollHeight + 'px';
          // 用 html2canvas 生成 PNG
          html2canvas(win).then(canvas => {
            const img = new Image();
            img.src = canvas.toDataURL('image/png');
            document.getElementById('images').appendChild(img);
            // 当第二张渲染完，移除聊天框
            if (id === 'chat-window-2') {
              document.querySelectorAll('.chat-window').forEach(w => w.remove());
            }
          });
        });
      }, 500);
    });
  </script>
</body>
</html>
